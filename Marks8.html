<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bright Academy Marks System</title>
  <style>
    body { font-family: Arial; padding: 20px; background-color: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eaeaea; }
    input[type="number"] { width: 60px; }
    .hidden { display: none; }
    .btn { padding: 10px; margin: 5px; cursor: pointer; background: #007BFF; color: white; border: none; border-radius: 5px; }
    .btn:hover { background: #0056b3; }
  </style>
</head>
<body>

<h1>Bright Academy - Student Marks System</h1>

<div>
  <label>Term: <input type="text" id="term" value="Term 1" /></label>
  <label>Year: <input type="number" id="year" value="2025" /></label>
  <label>Exam Type: <input type="text" id="examType" value="Mid Term" /></label>
</div><br>

<div>
  <label>Login as:
    <select id="role">
      <option value="admin">Admin</option>
      <option value="math">Math Teacher</option>
      <option value="english">English Teacher</option>
      <option value="kiswahili">Kiswahili Teacher</option>
      <option value="biology">Biology Teacher</option>
      <option value="physics">Physics Teacher</option>
      <option value="chemistry">Chemistry Teacher</option>
      <option value="history">History Teacher</option>
      <option value="geography">Geography Teacher</option>
      <option value="cre">CRE Teacher</option>
      <option value="business">Business Teacher</option>
    </select>
  </label>
  Password: <input type="password" id="password" />
  <button class="btn" onclick="login()">Login</button>
  <span id="status" style="margin-left: 10px; font-weight: bold;"></span>
</div><br>

<div id="main" class="hidden">
  <table id="marksTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Student Name</th>
        <th>Class</th>
        <!-- Subject columns or inputs added here -->
      </tr>
    </thead>
    <tbody id="marksBody">
      <!-- Student rows go here -->
    </tbody>
  </table>

  <button class="btn hidden" id="saveBtn" onclick="saveMarks()">Save Marks</button>
  <button class="btn hidden" id="analyzeBtn" onclick="analyze()">Analyze Marks</button>
  <button class="btn hidden" id="printBtn" onclick="printReport()">Print/Download Report</button>
</div>

<script>
const studentsByClass = {
  "Form 2 Scarlet": ["Milka Moraa", "Grace Wangari", "Jane Wanjiru", "Precious Wanjiru"],
  "Form 2 Lilac": ["Anne Mokeira", "Mary Onyango", "Damari Achieng", "Florian Wangari"],
  "Form 3 Peach": ["Hellen Monyangi", "Daisy Rabera", "Jesca Moraa", "Janet Atieno"],
  "Form 3 Scarlet": ["Mary Atieno", "Florence Achieng", "Kerubo James", "Monica Kemunto"]
};

const subjects = ["Math", "English", "Kiswahili", "Biology", "Physics", "Chemistry", "History", "Geography", "CRE", "Business"];
const passwords = {
  admin: "admin123",
  math: "math123",
  english: "english123",
  kiswahili: "kiswahili123",
  biology: "bio123",
  physics: "physics123",
  chemistry: "chem123",
  history: "hist123",
  geography: "geo123",
  cre: "cre123",
  business: "biz123"
};

let marksData = {};
let currentRole = "";

function login() {
  const role = document.getElementById("role").value;
  const pass = document.getElementById("password").value;

  if (passwords[role] === pass) {
    currentRole = role;
    document.getElementById("main").classList.remove("hidden");
    document.getElementById("status").textContent = `Logged in as ${role.toUpperCase()}`;
    document.getElementById("saveBtn").classList.toggle("hidden", role === "admin");
    document.getElementById("analyzeBtn").classList.toggle("hidden", role !== "admin");
    document.getElementById("printBtn").classList.toggle("hidden", role !== "admin");
    renderTable();
  } else {
    alert("Invalid password!");
  }
}

function renderTable() {
  const tbody = document.getElementById("marksBody");
  const thead = document.querySelector("#marksTable thead tr");
  tbody.innerHTML = "";

  while (thead.children.length > 3) thead.removeChild(thead.lastChild);

  if (currentRole === "admin") {
    subjects.forEach(s => {
      thead.innerHTML += `<th>${s}</th><th>Grade</th>`;
    });
    thead.innerHTML += `<th>Average</th><th>Grade</th><th>Position</th>`;
  } else {
    thead.innerHTML += `<th>${capitalize(currentRole)}</th>`;
  }

  let index = 1;
  for (const className in studentsByClass) {
    studentsByClass[className].forEach(student => {
      const sid = `${student}-${className}`;
      if (!marksData[sid]) marksData[sid] = {};

      let row = `<tr><td>${index++}</td><td>${student}</td><td>${className}</td>`;

      if (currentRole === "admin") {
        subjects.forEach(sub => {
          const score = marksData[sid][sub] || "";
          row += `<td>${score}</td><td>${grade(score)}</td>`;
        });
        const avg = average(marksData[sid]);
        row += `<td>${avg}</td><td>${grade(avg)}</td><td>${marksData[sid].position || "-"}</td>`;
      } else {
        const subjectName = capitalize(currentRole);
        const score = marksData[sid][subjectName] || "";
        row += `<td><input type="number" value="${score}" onchange="updateScore('${sid}', '${subjectName}', this.value)" /></td>`;
      }

      row += `</tr>`;
      tbody.innerHTML += row;
    });
  }
}

function updateScore(sid, subject, value) {
  marksData[sid][subject] = Number(value);
}

function saveMarks() {
  alert("Marks saved for subject: " + capitalize(currentRole));
}

function average(marks) {
  let total = 0, count = 0;
  subjects.forEach(s => {
    if (marks[s] !== undefined) {
      total += marks[s];
      count++;
    }
  });
  return count ? Math.round(total / count) : 0;
}

function grade(mark) {
  if (mark >= 80) return "A";
  if (mark >= 70) return "B";
  if (mark >= 60) return "C";
  if (mark >= 50) return "D";
  if (mark >= 40) return "E";
  return "F";
}

function analyze() {
  for (const sid in marksData) {
    marksData[sid].average = average(marksData[sid]);
  }

  for (const className in studentsByClass) {
    const ranked = studentsByClass[className].map(name => {
      const sid = `${name}-${className}`;
      return { sid, avg: marksData[sid].average || 0 };
    }).sort((a, b) => b.avg - a.avg);

    ranked.forEach((item, i) => {
      marksData[item.sid].position = i + 1;
    });
  }

  renderTable();
}

function printReport() {
  const term = document.getElementById("term").value;
  const year = document.getElementById("year").value;
  const type = document.getElementById("examType").value;

  let win = window.open("", "Print", "height=700,width=900");
  win.document.write(`<html><head><title>Reports</title>
    <style>table{width:100%;border-collapse:collapse}
    td,th{border:1px solid #000;padding:6px;text-align:center}
    </style></head><body>`);

  win.document.write(`<h1>Bright Academy</h1><p>Term: ${term} | Year: ${year} | Exam: ${type}</p>`);

  for (const className in studentsByClass) {
    win.document.write(`<h2>${className}</h2><table><tr><th>#</th><th>Student</th><th>Average</th><th>Grade</th><th>Position</th></tr>`);
    let i = 1;
    studentsByClass[className].forEach(name => {
      const sid = `${name}-${className}`;
      const avg = marksData[sid].average || 0;
      const pos = marksData[sid].position || "-";
      win.document.write(`<tr><td>${i++}</td><td>${name}</td><td>${avg}</td><td>${grade(avg)}</td><td>${pos}</td></tr>`);
    });
    win.document.write(`</table><br><p>Class Teacher Signature: ____________</p><p>Principal Signature: ____________</p><hr>`);
  }

  win.document.write(`</body></html>`);
  win.document.close();
  win.print();
}

function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}
</script>

</body>
</html>
